<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ephpai: Ephpai Class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ephpai<span id="projectnumber">&#160;0.01</span>
   </div>
   <div id="projectbrief">A PHP Class to easily interact with the OpenAI API (ChatGPT &amp; Dall-E)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="classEphpai.html">Ephpai</a> Class </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_src_README"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
## A PHP Class to easily interact with the OpenAI API (ChatGPT &amp; Dall-E)</h1>
<p >itâ€™s an unofficial class and This project has no commercial link with OpenAI.</p>
<p >In order to use it, you need to have an OpenAI account and valid api key from OpenAI :[Get api key from OpenAI] (<a href="https://openai.com/api/">https://openai.com/api/</a>)</p>
<h3><a class="anchor" id="autotoc_md2"></a>
MIT License</h3>
<p >Copyright (c) 2023 Thomas Missonier (<a href="#" onclick="location.href='mai'+'lto:'+'sou'+'rc'+'eza'+'xs'+'our'+'ce'+'zax'+'@g'+'mai'+'l.'+'com'; return false;">sourc<span class="obfuscator">.nosp@m.</span>ezax<span class="obfuscator">.nosp@m.</span>sourc<span class="obfuscator">.nosp@m.</span>ezax<span class="obfuscator">.nosp@m.</span>@gmai<span class="obfuscator">.nosp@m.</span>l.co<span class="obfuscator">.nosp@m.</span>m</a>)</p>
<p >Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p >The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p >THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Ephpai Class</h2>
<p >This easy PHP Class interacts with the API provided by OpenAI.</p>
<p >It allows, in a limited but simple way, to make requests and obtain answers for the following functions :</p>
<ul>
<li><b>Completion (text)</b>: Query, response and text generation. Support for "text-davinci-003" (cahtGPT), "text-curie-001", "text-babbage-001" and "text-ada-001" models. Possibility to define the maximum number of tokens. Fine temperature management. Can Export results as json, array or text.</li>
<li><b>Image Generation</b>: Easy switch from completion to image generation. Different image sizes, possibility of saving an image. Can display or save the image in jpeg format. Possibility to get an base64 encoded text or an url</li>
<li><b>Moderation</b>: Moderate contents and/or images through the API. Ability to automate moderation. Possibility to get the reasons of openAI moderation.</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
How to use it?</h2>
<p >It's easy, just create an <a class="el" href="classEphpai.html">Ephpai</a> object, execute the request, and retrieve the response.</p>
<p >In order to use the <a class="el" href="classEphpai.html">Ephpai</a> class, the OAIPIKEY environment variable must contain your api key (recommended). If you don't have access to environment variables on your server, you can use the <b>setApikey($key)</b> method.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
here is a simple example</h3>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">require &quot;Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;Whois is spiderman?&#39;); // Create object</div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">     echo ($$Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line"> </div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >Here is a sample answer : </p><div class="fragment"><div class="line">Result : Spider-Man is a Marvel Comics superhero created by Stan Lee and Steve Ditko in 1962. He is a costumed crime fighter with superhuman strength, agility, and the ability to cling to most surfaces. He uses his powers to protect the innocent and fight crime in New York City.</div>
</div><!-- fragment --><p >By default the request type is set to completion (text), and the model to text-davinci-003 (chatGPT). <a href="https://platform.openai.com/docs/models/overview">About models</a></p>
<p >The model can be modified with the method <b>setModel($model)</b>.</p>
<p >The number of tokens is fixed by default at 850, it can be changed with the method <b>setMaxtoken($number)</b>;</p>
<h4><a class="anchor" id="autotoc_md6"></a>
Modification of the previous query :</h4>
<div class="fragment"><div class="line">&lt;?php require &quot;Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;Who is spiderman?&#39;); // Create object</div>
<div class="line">$Requestgpt-&gt;setModel(&#39;text-curie-001&#39;); //model text-curie</div>
<div class="line">$Requestgpt-&gt;setMaxtoken(200); //Maxtoken=200</div>
<div class="line"> </div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">     echo ($$Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >Sample Answer : </p><div class="fragment"><div class="line">Result : Spiderman is a superhero who first appeared in the comic book series &quot;Amazing Fantasy&quot; in 1962. He is known for his webshooters, Spiderman suits, and his ability to climb walls.</div>
</div><!-- fragment --><p >There is a constructor with the model and maxtoken as parameters and allows us to make our task easier :</p>
<div class="fragment"><div class="line">&lt;?php require &quot;Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;Whois is spiderman?&#39;,&#39;text-curie-001&#39;,200); // Create object with model type &#39;text-curie-001&#39; and maxtoken=200 </div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">     echo ($$Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p> The result can be retrieved as a json format text,an array or as a text.</p>
<p >There are several methods for modifying the query parameters, such as temperature management, or retrieving values...</p>
<p >You can find them in the documentation, available in the "doc" directory (HTML &amp; pdf)</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Image generation</h2>
<p >To generate images using Dall-E and the OpenAI API, you need to enable image generation with the <b>generateImage(true)</b> method. To return to completion mode (text), just run this method with false as argument.</p>
<h4><a class="anchor" id="autotoc_md8"></a>
Example of image display using the GD library :</h4>
<p >Note: pay attention to unnecessary spaces. In this example, we ask a "cat blue" image and display it. It s a simple example.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">header(&quot;Content-type: image/jpeg&quot;);</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line">$Requestgpt=new Ephpai(&#39;blue cat&#39;);</div>
<div class="line">$Requestgpt-&gt;generateImage(true); //Activate image generation</div>
<div class="line">if((!$Requestgpt-&gt;setImgsize(&#39;1024x1024&#39;))||(!$Requestgpt-&gt;executeQuery()))</div>
<div class="line">     die ($Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">$imgdata=$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">$image = @imagecreatefromstring($imgdata);</div>
<div class="line">imagejpeg($image,null, 75);</div>
<div class="line">//echo $ImageData;</div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >If you don't want to bother with functions from the GD library, there is the <b>displayImg($nb,$quality)</b> method, which does all the work.</p>
<h4><a class="anchor" id="autotoc_md9"></a>
The same example with displayImg method</h4>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">header(&quot;Content-type: image/jpeg&quot;);</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line">$Requestgpt=new Ephpai(&#39;blue cat&#39;);</div>
<div class="line">$Requestgpt-&gt;generateImage(true);//</div>
<div class="line">if((!$Requestgpt-&gt;setImgsize(&#39;1024x1024&#39;))||(!$Requestgpt-&gt;executeQuery()))</div>
<div class="line">     die ($Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">    if (!$Requestgpt-&gt;displayImg(0,100))</div>
<div class="line">    die ($Requestgpt-&gt;error());</div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p> <b>In the same way, the **saveImgtojpeg($nb,$filename,$quality)</b> allows to save image on your server in jpeg format.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line">$string=&#39;blue cat and pink mouse playing card&#39;;</div>
<div class="line">$Requestgpt=new Ephpai($string);</div>
<div class="line">$Requestgpt-&gt;generateImage(true);//</div>
<div class="line">if((!$Requestgpt-&gt;setImgsize(&#39;1024x1024&#39;))||(!$Requestgpt-&gt;executeQuery()))</div>
<div class="line">     die ($Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">    if (!$Requestgpt-&gt;saveImgtojpeg(0,urlencode($string).&#39;.jpg&#39;,100))</div>
<div class="line">    die ($Requestgpt-&gt;error());</div>
<div class="line">    else </div>
<div class="line">    echo &#39;Image &#39;.urlencode($string).&#39;.jpg saved with success&#39;;</div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p> <b>Image size</b>: the OpenAI API allows a limited number of image sizes: 256x256,512x512 and 1024x1024.</p>
<p >For more information on the methods related to the generation of images, you will find more information in the documentation present in the doc directory.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Moderation</h2>
<p >It is recommended to use the moderation API provided by OpenAI in order not to submit requests that could be against OpenAI rules, especially if yours users can submit content.</p>
<p >Without making the request, It is possible to check that the content is in compliance with moderation.</p>
<p >Note that the moderation API is valid for any type of text, whether for an image or text.</p>
<p >This is a functional but limited implementation of the functionalities of moderation.</p>
<p >If it is possible to know the reasons for a moderation in the form of an array, the respective scores of each reason (numerical values) are not returned.</p>
<h4><a class="anchor" id="autotoc_md11"></a>
Example of moderation api. This request should be moderated :</h4>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;I want to hit you. i hate you&#39;); // Create object</div>
<div class="line">//Asks to moderation api to evaluate query.</div>
<div class="line">if ($Requestgpt-&gt; ModerateQuery()) </div>
<div class="line">     //Depending the result, the moderation status will be set to true (moderated) or false (no moderated).</div>
<div class="line">     if ($Requestgpt-&gt;moderation_status())</div>
<div class="line">        echo &quot;I&#39;m moderated&quot;;</div>
<div class="line">     else</div>
<div class="line">          echo &quot;I&#39;m correct&quot;;</div>
<div class="line">     else</div>
<div class="line">          echo  $Requestgpt-&gt;error();</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p> This sentence will be moderated. "I'm moderated" will be displayed.</p>
<p >Note : If moderation works correctly for the English language, support for other languages is limited.</p>
<p >It is possible to know the reason(s) for the moderation in the form of an array. Replace the line in the example above </p><div class="fragment"><div class="line">echo &quot;I&#39;m moderated&quot;;</div>
</div><!-- fragment --><p >by</p>
<div class="fragment"><div class="line">{</div>
<div class="line">         echo &quot;I&#39;m moderated. Reason(s) :&quot;;</div>
<div class="line">         foreach($Requestgpt-&gt;moderated_categories() as $reason)</div>
<div class="line">              echo $reason;</div>
<div class="line">       }</div>
</div><!-- fragment --><p> Here is the result, this request will be moderated for violence :</p>
<div class="fragment"><div class="line">I&#39;m moderated. Reason(s) :violence</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
Auto moderation</h3>
<p >It is possible to automatically moderate requests before sending them. The <b>Moderation_auto($status)</b> method enables this feature. If the query is moderated, the executeQuery() method will return <b>false</b> and moderation_status() will be <b>true</b>.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
Example of auto moderation</h3>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;enter your bad words..&#39;); // Create object</div>
<div class="line">$Requestgpt-&gt;Moderation_auto(true);</div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">{</div>
<div class="line">     if($Requestgpt-&gt;moderation_status())</div>
<div class="line">          echo &quot;I m moderated&quot;;</div>
<div class="line">     else echo ($$Requestgpt-&gt;error());</div>
<div class="line">}</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >**Thanks for reading</p>
<p >I hope this code can be useful for you.</p>
<p >Don't hesitate to contact me to show me your creations :)</p>
<p >Thomas Missonier </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
