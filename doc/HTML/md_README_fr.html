<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ephpai: Ephpai.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ephpai<span id="projectnumber">&#160;0.01</span>
   </div>
   <div id="projectbrief">A PHP Class to easily interact with the OpenAI API (ChatGPT &amp; Dall-E)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_README_fr.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Ephpai.php </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md4"></a>
Une Classe PHP pour intéragir facilement avec l'api d'OpenAI (ChatGPT &amp; Dall-E)</h1>
<p >Cette Classe PHP n'est pas une Classe officielle et ce projet n'a aucun lien commercial avec OpenAI.</p>
<p >Pour pouvoir l'utiliser vous devez disposer d'un compte OpenAI et d'une clé pour l'api : <a href="https://openai.com/api/">Get api key from OpenAI</a></p>
<h2><a class="anchor" id="autotoc_md5"></a>
MIT License</h2>
<p >Copyright (c) 2023 Thomas Missonier (<a href="#" onclick="location.href='mai'+'lto:'+'sou'+'rc'+'eza'+'xs'+'our'+'ce'+'zax'+'@g'+'mai'+'l.'+'com'; return false;">sourc<span class="obfuscator">.nosp@m.</span>ezax<span class="obfuscator">.nosp@m.</span>sourc<span class="obfuscator">.nosp@m.</span>ezax<span class="obfuscator">.nosp@m.</span>@gmai<span class="obfuscator">.nosp@m.</span>l.co<span class="obfuscator">.nosp@m.</span>m</a>)</p>
<p >Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p >The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p >THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Classe Ephpai</h1>
<p >Cette Classe PHP permet d'utiliser facilement l'api fournie par OpenAI.</p>
<p >Elle permet,de façon limitée mais simple, d'effectuer des requêtes et d'obtenir des réponses pour les fonctions suivantes :</p>
<ul>
<li><b>Completion (texte)</b> : Interrogation, réponses et génération de textes. Support des modèles "text-davinci-003" (chatGPT),"text-curie-001","text-babbage-001" et "text-ada-001". Possibilité de définir le nombre maximum de tokens, gestion fine de la temperature. Export possible sous forme de json, d'array ou de texte.</li>
<li><b>Génération d'images</b> : Permutation facile de la completion à la génération d'images. Gestion de différentes tailles d'image, possibilité de sauvegarder une image. Récupération de l'image à partir du contenu texte encodé au format base64 ou via url.</li>
<li><b>Modération</b> : Possibilité de modérer automatiquement des requêtes ou du contenu par l'intermédiaire de l'api. Possibilité d'automatisation de la Modération. Possibilité d'obtenir les raisons pour lesquelles l'api d'openAI a modéré les contenus.</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Comment l'utiliser?</h1>
<p >Cela est fait de manière très simple, il suffit de créer un objet <a class="el" href="classEphpai.html">Ephpai</a>, d'éxécuter la requête, et de récupérer la réponse.</p>
<p >Pour utiliser la classe <a class="el" href="classEphpai.html">Ephpai</a>, la variable d'environnement OAIPIKEY doit contenir votre clé d'api (conseillé). Si vous n''avez pas accès aux variables d'environnement sur votre serveur, vous pouvez utiliser la méthode <b>setApikey($key)</b>.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Voici un exemple simple :</h3>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">require &quot;Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;Who is Spiderman?&#39;); // Create object</div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">     echo ($$Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line"> </div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >Voici un exemple de réponse : </p><div class="fragment"><div class="line">Result : Spider-Man is a Marvel Comics superhero created by Stan Lee and Steve Ditko in 1962. He is a costumed crime fighter with superhuman strength, agility, and the ability to cling to most surfaces. He uses his powers to protect the innocent and fight crime in New York City.</div>
</div><!-- fragment --><p >Par défaut le type de recherche est défini sur la completion (texte), et le modèle text-davinci-003 ("chatGPT").</p>
<p ><a href="https://platform.openai.com/docs/models/overview">A propos des modèles</a></p>
<p >Il est possible de le modifier avec la Méthode, <b>setModel($model)</b></p>
<p >Le nombre de tokens est fixé par défaut à 850, il est possible de le modifier via la méthode <b>setMaxtoken($nombre)</b>;</p>
<h3><a class="anchor" id="autotoc_md16"></a>
Exemple de modification de la requête précédente :</h3>
<div class="fragment"><div class="line">&lt;?php require &quot;Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;Who is Spiderman?&#39;); // Create object</div>
<div class="line">$Requestgpt-&gt;setModel(&#39;text-curie-001&#39;); //model text-curie</div>
<div class="line">$Requestgpt-&gt;setMaxtoken(200); //Maxtoken=200</div>
<div class="line"> </div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">     echo ($$Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p> Exemple de réponse :</p>
<div class="fragment"><div class="line">Result : Spiderman is a superhero who first appeared in the comic book series &quot;Amazing Fantasy&quot; in 1962. He is known for his webshooters, Spiderman suits, and his ability to climb walls.</div>
</div><!-- fragment --><p >Il y a un constructeur qui accepte le modèle et maxtoken en paramètres et permet de nous faciliter la tâche :</p>
<div class="fragment"><div class="line">&lt;?php require &quot;Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;Who is spiderman?&#39;,&#39;text-curie-001&#39;,200); // Create object with model type &#39;text-curie-001&#39; and maxtoken=200 </div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">     echo ($$Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p> Le résultat peut être récupéré au format json, sous forme d'array ou sous forme de texte.</p>
<p >Il existe plusieurs méthodes permettant de modifier les paramètres de la requetes, comme la gestion de la temperature par exemple, ou de récupérer des valeurs. Elles sont documentées dans la documentation, disponible dans le répertoire doc.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Génération d'images</h1>
<p >Pour générer des images en utilisant Dall-E et l'api d'OpenAI, il faut activer la génération d'image avec la méthode <b>generateImage(true)</b>. Il est possible de revenir au mode completion (texte), en lui passant false comme paramètre.</p>
<h3><a class="anchor" id="autotoc_md20"></a>
Exemple d'affichage d'image en utilisant la librairie GD :</h3>
<p >Dans cet exemple nous générons une image de chat bleu. L'exemple est volontairement simpliste.</p>
<p >Note : Il est important de n'avoir aucun espace superflu. </p><div class="fragment"><div class="line">&lt;?php</div>
<div class="line">header(&quot;Content-type: image/jpeg&quot;);</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line">$Requestgpt=new Ephpai(&#39;blue cat&#39;);</div>
<div class="line">$Requestgpt-&gt;generateImage(true); //Activate image generation</div>
<div class="line">if((!$Requestgpt-&gt;setImgsize(&#39;1024x1024&#39;))||(!$Requestgpt-&gt;executeQuery()))</div>
<div class="line">     die ($Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">$imgdata=$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">$image = @imagecreatefromstring($imgdata);</div>
<div class="line">imagejpeg($image,null, 75);</div>
<div class="line">//echo $ImageData;</div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >Si vous ne vous voulez pas vous embêter avec les fonctions de la librairie GD, il existe la méthode <b>displayImg($nb,$quality)</b>, qui fait tout le travail.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Le même exemple avec l'utilisation de la méthode displayImg :</h3>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">header(&quot;Content-type: image/jpeg&quot;);</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line">$Requestgpt=new Ephpai(&#39;blue cat&#39;);</div>
<div class="line">$Requestgpt-&gt;generateImage(true);//</div>
<div class="line">if((!$Requestgpt-&gt;setImgsize(&#39;1024x1024&#39;))||(!$Requestgpt-&gt;executeQuery()))</div>
<div class="line">     die ($Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">    if (!$Requestgpt-&gt;displayImg(0,100))</div>
<div class="line">    die ($Requestgpt-&gt;error());</div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md22"></a>
De la même manière, la méthode &lt;strong&gt;saveImgtojpeg($nb,$filename,$quality)&lt;/strong&gt; permet de sauvegarder l'image sur son serveur :</h3>
<p >Cette fois ci, le theme de l'image sera "un chat bleu et une souris rose jouant au cartes" d'une dimension de 1024x1024, qui sera sauvée sur le serveur Note : Il aurait pu être possible de l'afficher aussi en utilisant la methode <b>displayImg</b> (voir ci-dessus). </p><div class="fragment"><div class="line">&lt;?php</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line">$string=&#39;blue cat and pink mouse playing card&#39;;</div>
<div class="line">$Requestgpt=new Ephpai($string);</div>
<div class="line">$Requestgpt-&gt;generateImage(true);//</div>
<div class="line">if((!$Requestgpt-&gt;setImgsize(&#39;1024x1024&#39;))||(!$Requestgpt-&gt;executeQuery()))</div>
<div class="line">     die ($Requestgpt-&gt;error());</div>
<div class="line">else</div>
<div class="line">{</div>
<div class="line">    if (!$Requestgpt-&gt;saveImgtojpeg(0,urlencode($string).&#39;.jpg&#39;,100))</div>
<div class="line">    die ($Requestgpt-&gt;error());</div>
<div class="line">    else </div>
<div class="line">    echo &#39;Image &#39;.urlencode($string).&#39;.jpg saved with success&#39;;</div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p ><b>Taille des images</b> : l'api d'OpenAI permet un nombre restreint de taille d'image : 256x256,512x512 et 1024x1024.</p>
<p >Pour plus d'informations sur les méthodes liées à la génération d'images, vous trouverez plus d'informations dans la documentation présente dans le répertoire doc.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Modération</h1>
<p >Il est conseillé d'utiliser l'api de modération fournie par OpenAI afin de ne pas soumettre de requêtes qui pourraient être contraires aux règles d'OpenAI, notamment si vous offrez à vos utilisateurs la possibilité de soumettre du contenu.</p>
<p >Il est possible de vérifier auprès de l'api, sans effectuer la requête, que le contenu est conforme à la modération.</p>
<p >A noter que l'api de modération est valable sur tout type de texte que ce soit pour une image ou du texte.</p>
<p >Il sagit d'une implémentation fonctionnelle mais limitée de l'usage de la modération.</p>
<p >S'il est possible de connaître les raisons d'une modération sous forme d'array, les scores respectifs de chaque raison (valeur numérique) ne sont pas retournés.</p>
<h3><a class="anchor" id="autotoc_md26"></a>
Cet exemple interroge l'api de moderation sur la conformité du texte de la requête. Cette requête devrait être modérée :</h3>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;I want to hit you. i hate you&#39;); // Create object</div>
<div class="line">//Asks to moderation api to evaluate query.</div>
<div class="line">if ($Requestgpt-&gt; ModerateQuery()) </div>
<div class="line">     //Depending the result, the moderation status will be set to true (moderated) or false (no moderated).</div>
<div class="line">     if ($Requestgpt-&gt;moderation_status())</div>
<div class="line">        echo &quot;I&#39;m moderated&quot;;</div>
<div class="line">     else</div>
<div class="line">          echo &quot;I&#39;m correct&quot;;</div>
<div class="line">     else</div>
<div class="line">          echo  $Requestgpt-&gt;error();</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >Cette phrase sera modérée. "I'm moderated" sera affiché.</p>
<p >A noter que si la modération fonctionne correctement pour la langue anglaise ,le support des autres langues est limité.</p>
<p >Il est possible de connaitre la ou les raisons de la modération sous forme d'array. Remplacer la ligne dans l'exemple ci-dessus</p>
<div class="fragment"><div class="line">echo &quot;I&#39;m moderated&quot;;</div>
</div><!-- fragment --><p >par</p>
<div class="fragment"><div class="line">{</div>
<div class="line">         echo &quot;I&#39;m moderated. Reason(s) :&quot;;</div>
<div class="line">         foreach($Requestgpt-&gt;moderated_categories() as $reason)</div>
<div class="line">              echo $reason;</div>
<div class="line">       }</div>
</div><!-- fragment --><p >Voici le résultat, cette requête sera modérée pour violence :</p>
<div class="fragment"><div class="line">I&#39;m moderated. Reason(s) :violence</div>
</div><!-- fragment --><p >La méthode moderated_categories() renvoie une array contenant les différentes raisons de la modération.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Modération automatique</h2>
<p >Il est possible de modérer automatiquement les requêtes avant envoi. La méthode <b>Moderation_auto($status)</b> permet d'activer cette fonctionnalité. Si la requête est modérée, la méthode executeQuery() retournera false et moderation_status() sera à true.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Exemple de modération automatique de requête</h2>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">require &quot;../Ephpai.php&quot;;</div>
<div class="line"> </div>
<div class="line">$Requestgpt=new Ephpai(&#39;enter your bad words..&#39;); // Create object</div>
<div class="line">$Requestgpt-&gt;Moderation_auto(true);</div>
<div class="line">if (!$Requestgpt-&gt;executeQuery())</div>
<div class="line">{</div>
<div class="line">     if($Requestgpt-&gt;moderation_status())</div>
<div class="line">          echo &quot;I m moderated&quot;;</div>
<div class="line">     else echo ($$Requestgpt-&gt;error());</div>
<div class="line">}</div>
<div class="line">else</div>
<div class="line">echo &quot;Result :&quot;.$Requestgpt-&gt;getTextresult(0);</div>
<div class="line">?&gt;</div>
</div><!-- fragment --><p >**Merci de votre lecture</p>
<p >J'espère que ce code pourra vous être utile.</p>
<p >N'hésitez pas à me contacter pour me montrer vos réalisations :)</p>
<p >Thomas Missonier </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
